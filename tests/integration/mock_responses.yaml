scenarios:
  # INT-011: Planner target caps validation (No specific mock needed as it's a validation test)

  INT-014:
    planner:
      summary: "Plan with MOCK-MOTOR-ID generated."
      thought: "I will design a mechanism with a servo motor using MOCK-MOTOR-ID."
      tool_calls:
        - name: "write_file"
          input: 
            path: "plan.md"
            content: |
              ## 1. Solution Overview
              Mechanism with MOCK-MOTOR-ID.
              ## 2. Parts List
              - MOCK-MOTOR-ID (Servo Motor)
              ## 3. Assembly Strategy
              1. Attach motor.
              ## 4. Cost & Weight Budget
              - $20
              ## 5. Risk Assessment
              - Low.
            overwrite: true
        - name: "write_file"
          input: { path: "todo.md", content: "- [ ] Design with MOCK-MOTOR-ID", overwrite: true }
        - name: "write_file"
          input: 
            path: "assembly_definition.yaml"
            content: |
              version: '1.0'
              constraints:
                benchmark_max_unit_cost_usd: 100
                benchmark_max_weight_g: 1000
                planner_target_max_unit_cost_usd: 50
                planner_target_max_weight_g: 500
              totals:
                estimated_unit_cost_usd: 10
                estimated_weight_g: 100
                estimate_confidence: high
              manufactured_parts: []
              cots_parts:
                - part_number: "MOCK-MOTOR-ID"
                  category: "motor"
                  quantity: 1
              final_assembly: []
            overwrite: true
        - name: "write_file"
          input: { path: "objectives.yaml", content: "constraints: {max_unit_cost: 50, max_weight_g: 1000.0}", overwrite: true }
    electronics_planner:
      summary: "No electronics needed."
      thought: "No electronics needed."
      tool_calls:
        - name: "write_file"
          input: { path: "todo.md", content: "- [x] Initial plan\n- [x] Check electronics", overwrite: true }
    coder:
      journal: "Implemented mechanism with MOCK-MOTOR-ID."
      thought: "Implementing the design."
      generated_code: |
        from build123d import *
        import os
        import trimesh
        os.makedirs('assets', exist_ok=True)
        b = Box(10,10,10)
        export_stl(b, 'assets/box.stl')
        mesh = trimesh.load('assets/box.stl')
        mesh.export('assets/box.glb', file_type='glb')
        with open('script.py', 'w') as f: f.write('from build123d import *\\ndef build(): return Box(10,10,10)')
    reviewer:
      review:
        decision: "APPROVED"
        reason: "The design satisfies all requirements."
        required_fixes: []

  # INT-002: Engineering execution boundary
  test-exec:
    planner:
      summary: "Plan for 10x10x10mm box generated."
      thought: "I will generate the engineering plan for the 10x10x10mm box."
      tool_calls:
        - name: "write_file"
          input: 
            path: "plan.md"
            content: |
              ## 1. Solution Overview
              Build a box.
              ## 2. Parts List
              - Box (manufactured, abs)
              ## 3. Assembly Strategy
              1. Connect.
              ## 4. Cost & Weight Budget
              - $10
              ## 5. Risk Assessment
              - Low.
            overwrite: true
        - name: "write_file"
          input: { path: "todo.md", content: "- [ ] Step 1", overwrite: true }
        - name: "write_file"
          input: 
            path: "assembly_definition.yaml"
            content: |
              version: '1.0'
              constraints:
                benchmark_max_unit_cost_usd: 100
                benchmark_max_weight_g: 1000
                planner_target_max_unit_cost_usd: 50
                planner_target_max_weight_g: 500
              totals:
                estimated_unit_cost_usd: 10
                estimated_weight_g: 100
                estimate_confidence: high
              manufactured_parts: []
              cots_parts: []
              final_assembly: []
            overwrite: true
        - name: "write_file"
          input: { path: "objectives.yaml", content: "objectives: {goal_zone: {min: [0,0,0], max: [1,1,1]}, build_zone: {min: [0,0,0], max: [1,1,1]}}\nsimulation_bounds: {min: [-10,-10,-10], max: [10,10,10]}\nmoved_object: {label: obj, shape: sphere, start_position: [0,0,0], runtime_jitter: [0,0,0]}\nconstraints: {max_unit_cost: 50, max_weight_g: 1000.0}", overwrite: true }
    electronics_planner:
      summary: "No electronics needed."
      thought: "No electronics needed."
      tool_calls:
        - name: "write_file"
          input: { path: "todo.md", content: "- [x] Initial plan\n- [x] Check electronics", overwrite: true }
    coder:
      journal: "Implemented box and ran simulation."
      thought: "I will implement the box in build123d and run simulation."
      generated_code: |
        from build123d import *
        import os
        import trimesh
        # Create GLB
        os.makedirs('assets', exist_ok=True)
        b = Box(10,10,10)
        export_stl(b, 'assets/box.stl')
        mesh = trimesh.load('assets/box.stl')
        mesh.export('assets/box.glb', file_type='glb')
        with open('solution.py', 'w') as f: f.write('from build123d import *\\ndef build(): return Box(10,10,10)')
        with open('simulation_result.json', 'w') as f: f.write('{"success": true}')
    reviewer:
      review:
        decision: "APPROVED"
        reason: "The design satisfies all requirements."
        required_fixes: []

  INT-173:
    planner:
      summary: "Plan for cube generated."
      thought: "Planning for INT-173."
      tool_calls:
        - name: "write_file"
          input: 
            path: "plan.md"
            content: |
              ## 1. Solution Overview
              Cube test.
              ## 2. Parts List
              - Cube
              ## 3. Assembly Strategy
              1. Place.
              ## 4. Cost & Weight Budget
              - $5
              ## 5. Risk Assessment
              - Minimal.
            overwrite: true
        - name: "write_file"
          input: { path: "todo.md", content: "- [ ] Create cube", overwrite: true }
        - name: "write_file"
          input: 
            path: "assembly_definition.yaml"
            content: |
              version: '1.0'
              constraints:
                benchmark_max_unit_cost_usd: 100
                benchmark_max_weight_g: 1000
                planner_target_max_unit_cost_usd: 50
                planner_target_max_weight_g: 500
              totals:
                estimated_unit_cost_usd: 10
                estimated_weight_g: 100
                estimate_confidence: high
              manufactured_parts: []
              cots_parts: []
              final_assembly: []
            overwrite: true
        - name: "write_file"
          input: { path: "objectives.yaml", content: "constraints: {max_unit_cost: 50, max_weight_g: 1000.0}", overwrite: true }
    coder:
      journal: "Created cube GLB."
      thought: "Creating cube GLB."
      generated_code: |
        from build123d import *
        import os
        import trimesh
        os.makedirs('assets', exist_ok=True)
        b = Box(10,10,10)
        export_stl(b, 'assets/box.stl')
        mesh = trimesh.load('assets/box.stl')
        mesh.export('assets/box.glb', file_type='glb')
        with open('script.py', 'w') as f: f.write('from build123d import *\\ndef build(): return Box(10,10,10)')

  INT-174:
    planner:
      summary: "Plan for two parts generated."
      thought: "Planning for INT-174."
      tool_calls:
        - name: "write_file"
          input: 
            path: "plan.md"
            content: |
              ## 1. Solution Overview
              Two parts test.
              ## 2. Parts List
              - Part 1
              - Part 2
              ## 3. Assembly Strategy
              1. Connect.
              ## 4. Cost & Weight Budget
              - $10
              ## 5. Risk Assessment
              - Low.
            overwrite: true
        - name: "write_file"
          input: { path: "todo.md", content: "- [ ] Create parts", overwrite: true }
        - name: "write_file"
          input: 
            path: "assembly_definition.yaml"
            content: |
              version: '1.0'
              constraints:
                benchmark_max_unit_cost_usd: 100
                benchmark_max_weight_g: 1000
                planner_target_max_unit_cost_usd: 50
                planner_target_max_weight_g: 500
              totals:
                estimated_unit_cost_usd: 10
                estimated_weight_g: 100
                estimate_confidence: high
              manufactured_parts: []
              cots_parts: []
              final_assembly: []
            overwrite: true
        - name: "write_file"
          input: { path: "objectives.yaml", content: "constraints: {max_unit_cost: 50, max_weight_g: 1000.0}", overwrite: true }
    coder:
      journal: "Created two parts GLB."
      thought: "Creating two parts GLB."
      generated_code: |
        from build123d import *
        import os
        import trimesh
        os.makedirs('assets', exist_ok=True)
        b1 = Box(10,10,10)
        b1.name = "part1"
        b2 = Box(5,5,5).translate((20,0,0))
        b2.name = "part2"
        c = b1 + b2
        export_stl(c, 'assets/box.stl')
        mesh = trimesh.load('assets/box.stl')
        mesh.export('assets/box.glb', file_type='glb')
        with open('script.py', 'w') as f: f.write('from build123d import *\\ndef build(): return Box(10,10,10)')

  INT-176:
    planner:
      summary: "Plan for failure test generated."
      thought: "Testing tool failure recovery."
      tool_calls:
        - name: "write_file"
          input: 
            path: "plan.md"
            content: |
              ## 1. Solution Overview
              Fail test.
              ## 2. Parts List
              - Test part
              ## 3. Assembly Strategy
              1. Test step
              ## 4. Cost & Weight Budget
              - Test budget
              ## 5. Risk Assessment
              - Test risk
            overwrite: true
        - name: "write_file"
          input: { path: "todo.md", content: "- [ ] Fail a tool\n- [ ] Continue", overwrite: true }
        - name: "write_file"
          input: 
            path: "assembly_definition.yaml"
            content: |
              version: '1.0'
              constraints:
                benchmark_max_unit_cost_usd: 100
                benchmark_max_weight_g: 1000
                planner_target_max_unit_cost_usd: 50
                planner_target_max_weight_g: 500
              totals:
                estimated_unit_cost_usd: 10
                estimated_weight_g: 100
                estimate_confidence: high
              manufactured_parts: []
              cots_parts: []
              final_assembly: []
            overwrite: true
        - name: "write_file"
          input: { path: "objectives.yaml", content: "constraints: {max_unit_cost: 50, max_weight_g: 1000.0}", overwrite: true }
    electronics_planner:
      summary: "No electronics needed."
      thought: "No electronics needed."
      tool_calls:
        - name: "write_file"
          input: { path: "todo.md", content: "- [x] Initial plan\n- [x] Check electronics", overwrite: true }
    coder:
      journal: "Observed failure but continued work."
      thought: "I will call a command that fails, then continue."
      tool_calls:
        - name: "execute_command"
          input: { command: "python3 -c \"from build123d import *; import trimesh; import os; os.makedirs('assets', exist_ok=True); b=Box(10,10,10); export_stl(b, 'assets/box.stl'); trimesh.load('assets/box.stl').export('assets/box.glb', file_type='glb')\"" }
        - name: "execute_command"
          input: { command: "ls /non_existent_path_to_fail" }
          thought: "Attempting to list non-existent path."
        - name: "write_file"
          input: { path: "script.py", content: "# Recovered", overwrite: true }
    reviewer:
      review:
        decision: "APPROVED"
        reason: "The design satisfies all requirements."
        required_fixes: []

  INT-177:
    planner:
      summary: "Plan for INT-177 generated."
      thought: "Planning for INT-177."
      tool_calls:
        - name: "execute_command"
          input:
            command: |
              cat > plan.md <<'EOF'
              ## 1. Solution Overview
              Test feedback.
              ## 2. Parts List
              - Test part
              ## 3. Assembly Strategy
              1. Test step
              ## 4. Cost & Weight Budget
              - Test budget
              ## 5. Risk Assessment
              - Test risk
              EOF
              cat > todo.md <<'EOF'
              - [x] Initial plan
              - [x] Check electronics
              EOF
              cat > assembly_definition.yaml <<'EOF'
              version: '1.0'
              constraints:
                benchmark_max_unit_cost_usd: 100
                benchmark_max_weight_g: 1000
                planner_target_max_unit_cost_usd: 50
                planner_target_max_weight_g: 500
              totals:
                estimated_unit_cost_usd: 10
                estimated_weight_g: 100
                estimate_confidence: high
              manufactured_parts: []
              cots_parts: []
              final_assembly: []
              EOF
              cat > objectives.yaml <<'EOF'
              constraints:
                max_unit_cost: 50
                max_weight_g: 1000.0
              EOF
        - name: "write_file"
          input: { path: "todo.md", content: "- [ ] Test", overwrite: true }
        - name: "write_file"
          input: 
            path: "assembly_definition.yaml"
            content: |
              version: '1.0'
              constraints:
                benchmark_max_unit_cost_usd: 100
                benchmark_max_weight_g: 1000
                planner_target_max_unit_cost_usd: 50
                planner_target_max_weight_g: 500
              totals:
                estimated_unit_cost_usd: 10
                estimated_weight_g: 100
                estimate_confidence: high
              manufactured_parts: []
              cots_parts: []
              final_assembly: []
            overwrite: true
        - name: "write_file"
          input: { path: "objectives.yaml", content: "constraints: {max_unit_cost: 50, max_weight_g: 1000.0}", overwrite: true }
    electronics_planner:
      summary: "No electronics needed."
      thought: "No electronics needed."
      tool_calls:
        - name: "write_file"
          input: { path: "todo.md", content: "- [x] Initial plan\n- [x] Check electronics", overwrite: true }
        - name: "write_file"
          input: 
            path: "plan.md"
            content: |
              ## 1. Solution Overview
              Test feedback.
              ## 2. Parts List
              - Test part
              ## 3. Assembly Strategy
              1. Test step
              ## 4. Cost & Weight Budget
              - Test budget
              ## 5. Risk Assessment
              - Test risk
            overwrite: true
        - name: "write_file"
          input: 
            path: "assembly_definition.yaml"
            content: |
              version: '1.0'
              constraints:
                benchmark_max_unit_cost_usd: 100
                benchmark_max_weight_g: 1000
                planner_target_max_unit_cost_usd: 50
                planner_target_max_weight_g: 500
              totals:
                estimated_unit_cost_usd: 10
                estimated_weight_g: 100
                estimate_confidence: high
              manufactured_parts: []
              cots_parts: []
              final_assembly: []
            overwrite: true
    coder:
      journal: "Coding for INT-177 complete."
      thought: "Coding for INT-177."
      tool_calls:
        - name: "execute_command"
          input: { command: "python3 -c \"from build123d import *; import trimesh; import os; os.makedirs('assets', exist_ok=True); b=Box(10,10,10); export_stl(b, 'assets/box.stl'); trimesh.load('assets/box.stl').export('assets/box.glb', file_type='glb')\"" }
        - name: "write_file"
          input: { path: "script.py", content: "# Test script", overwrite: true }
    reviewer:
      review:
        decision: "APPROVED"
        reason: "The design satisfies all requirements."
        required_fixes: []

  INT-179:
    planner:
      summary: "Plan for INT-179 generated."
      thought: "Planning for INT-179."
      tool_calls:
        - name: "write_file"
          input: 
            path: "plan.md"
            content: |
              ## 1. Solution Overview
              Test mentions.
              ## 2. Parts List
              - Test part
              ## 3. Assembly Strategy
              1. Test step
              ## 4. Cost & Weight Budget
              - Test budget
              ## 5. Risk Assessment
              - Test risk
            overwrite: true
        - name: "write_file"
          input: { path: "todo.md", content: "- [ ] Test", overwrite: true }
        - name: "write_file"
          input: 
            path: "assembly_definition.yaml"
            content: |
              version: '1.0'
              constraints:
                benchmark_max_unit_cost_usd: 100
                benchmark_max_weight_g: 1000
                planner_target_max_unit_cost_usd: 50
                planner_target_max_weight_g: 500
              totals:
                estimated_unit_cost_usd: 10
                estimated_weight_g: 100
                estimate_confidence: high
              manufactured_parts: []
              cots_parts: []
              final_assembly: []
            overwrite: true
        - name: "write_file"
          input: { path: "objectives.yaml", content: "constraints: {max_unit_cost: 50, max_weight_g: 1000.0}", overwrite: true }
    electronics_planner:
      summary: "No electronics needed."
      thought: "No electronics needed."
      tool_calls:
        - name: "write_file"
          input: { path: "todo.md", content: "- [x] Initial plan\n- [x] Check electronics", overwrite: true }
        - name: "write_file"
          input: 
            path: "plan.md"
            content: |
              ## 1. Solution Overview
              Test mentions.
              ## 2. Parts List
              - Test part
              ## 3. Assembly Strategy
              1. Test step
              ## 4. Cost & Weight Budget
              - Test budget
              ## 5. Risk Assessment
              - Test risk
            overwrite: true
        - name: "write_file"
          input: 
            path: "assembly_definition.yaml"
            content: |
              version: '1.0'
              constraints:
                benchmark_max_unit_cost_usd: 100
                benchmark_max_weight_g: 1000
                planner_target_max_unit_cost_usd: 50
                planner_target_max_weight_g: 500
              totals:
                estimated_unit_cost_usd: 10
                estimated_weight_g: 100
                estimate_confidence: high
              manufactured_parts: []
              cots_parts: []
              final_assembly: []
            overwrite: true
    coder:
      journal: "Coding for INT-179 complete."
      thought: "Coding for INT-179."
      tool_calls:
        - name: "execute_command"
          input: { command: "python3 -c \"from build123d import *; import trimesh; import os; os.makedirs('assets', exist_ok=True); b=Box(10,10,10); export_stl(b, 'assets/box.stl'); trimesh.load('assets/box.stl').export('assets/box.glb', file_type='glb')\"" }
        - name: "write_file"
          input: { path: "script.py", content: "# Test script for mentions\nfrom shared.models.schemas import PartMetadata\n# line 3\n# line 4\n# line 5\n# line 6\n# line 7\n# line 8\n# line 9\n# line 10", overwrite: true }
    reviewer:
      review:
        decision: "APPROVED"
        reason: "The design satisfies all requirements."
        required_fixes: []

  # Benchmark workflow (detected by prompt or UUID session_id)
  benchmark:
    planner:
      thought: "Designing benchmark scenario."
      plan:
        theme: "benchmark_test"
        reasoning: "Creating a simple path planning task."
        params: { wall_height: 5, goal_pos: [10, 10, 0] }
      reasoning: "Creating a simple benchmark."
      tool_calls:
        - name: "write_file"
          input: 
            path: "plan.md"
            content: |
              ## Learning Objective
              - Move a sphere into the goal zone.
              ## Geometry
              - Simple box environment around origin.
              ## Objectives
              - Reach goal while avoiding forbid zone.
            overwrite: true
        - name: "write_file"
          input: { path: "todo.md", content: "- [ ] Test benchmark", overwrite: true }
        - name: "write_file"
          input: 
            path: "objectives.yaml"
            content: |
              objectives:
                goal_zone:
                  min: [6, -2, 0]
                  max: [10, 2, 4]
                forbid_zones:
                  - name: "obstacle_collision_zone"
                    min: [2, -3, 0]
                    max: [4, 3, 4]
                build_zone:
                  min: [-10, -10, -10]
                  max: [10, 10, 10]
              simulation_bounds:
                min: [-20, -20, -20]
                max: [20, 20, 20]
              moved_object:
                label: "projectile_ball"
                shape: "sphere"
                static_randomization:
                  radius: [1, 2]
                start_position: [0, 0, 0]
                runtime_jitter: [0.5, 0.5, 0.5]
              constraints:
                max_unit_cost: 50.0
                max_weight_g: 1200.0
              randomization:
                static_variation_id: "v1.0"
                runtime_jitter_enabled: true
            overwrite: true
    coder:
      journal: "Work completed."
      thought: "Implementing benchmark script and setting up mandatory files."
      generated_code: |
        from build123d import *
        from shared.models.schemas import PartMetadata
        import os
        import trimesh
        
        # Create GLB
        os.makedirs('assets', exist_ok=True)
        b = Box(10,10,10)
        export_stl(b, 'assets/box.stl')
        mesh = trimesh.load('assets/box.stl')
        mesh.export('assets/box.glb', file_type='glb')

        with open('script.py', 'w') as f:
            f.write('from build123d import *\nfrom shared.models.schemas import PartMetadata\ndef build():\n    b = Box(10,10,10)\n    b.label = "box"\n    b.metadata = PartMetadata(material_id="abs", fixed=True)\n    return b')

  # Default fallback
  default:
    planner:
      summary: "Default plan generated."
      thought: "Default planner response."
      tool_calls:
        - name: "write_file"
          input: 
            path: "plan.md"
            content: |
              ## 1. Solution Overview
              Default.
              ## 2. Parts List
              - Default
              ## 3. Assembly Strategy
              1. Default
              ## 4. Cost & Weight Budget
              - Default
              ## 5. Risk Assessment
              - Default
            overwrite: true
        - name: "write_file"
          input: { path: "todo.md", content: "- [ ] Done", overwrite: true }
        - name: "write_file"
          input: 
            path: "assembly_definition.yaml"
            content: |
              version: '1.0'
              constraints:
                benchmark_max_unit_cost_usd: 100
                benchmark_max_weight_g: 1000
                planner_target_max_unit_cost_usd: 50
                planner_target_max_weight_g: 500
              totals:
                estimated_unit_cost_usd: 10
                estimated_weight_g: 100
                estimate_confidence: high
              manufactured_parts: []
              cots_parts: []
              final_assembly: []
            overwrite: true
        - name: "write_file"
          input: { path: "objectives.yaml", content: "objectives: {goal_zone: {min: [0,0,0], max: [1,1,1]}, build_zone: {min: [0,0,0], max: [1,1,1]}}\nsimulation_bounds: {min: [-10,-10,-10], max: [10,10,10]}\nmoved_object: {label: obj, shape: sphere, start_position: [0,0,0], runtime_jitter: [0,0,0]}\nconstraints: {max_unit_cost: 50, max_weight_g: 1000.0}", overwrite: true }
    electronics_planner:
      summary: "No electronics needed."
      thought: "No electronics needed."
      tool_calls:
        - name: "write_file"
          input: { path: "todo.md", content: "- [x] Initial plan\n- [x] Check electronics", overwrite: true }
        - name: "write_file"
          input: 
            path: "plan.md"
            content: |
              ## 1. Solution Overview
              Default.
              ## 2. Parts List
              - Default
              ## 3. Assembly Strategy
              1. Default
              ## 4. Cost & Weight Budget
              - Default
              ## 5. Risk Assessment
              - Default
            overwrite: true
        - name: "write_file"
          input: 
            path: "assembly_definition.yaml"
            content: |
              version: '1.0'
              constraints:
                benchmark_max_unit_cost_usd: 100
                benchmark_max_weight_g: 1000
                planner_target_max_unit_cost_usd: 50
                planner_target_max_weight_g: 500
              totals:
                estimated_unit_cost_usd: 10
                estimated_weight_g: 100
                estimate_confidence: high
              manufactured_parts: []
              cots_parts: []
              final_assembly: []
            overwrite: true
    coder:
      journal: "Work completed."
      thought: "Default coder response."
      generated_code: |
        from build123d import *
        from shared.models.schemas import PartMetadata
        import os
        import trimesh
        
        # Create GLB
        os.makedirs('assets', exist_ok=True)
        b = Box(10,10,10)
        export_stl(b, 'assets/box.stl')
        mesh = trimesh.load('assets/box.stl')
        mesh.export('assets/box.glb', file_type='glb')

        with open('script.py', 'w') as f:
            f.write('from build123d import *\nfrom shared.models.schemas import PartMetadata\ndef build():\n    b = Box(10,10,10)\n    b.label = "box"\n    b.metadata = PartMetadata(material_id="abs", fixed=True)\n    return b')
    reviewer:
      review:
        decision: "APPROVED"
        reason: "The design satisfies all requirements."
        required_fixes: []
