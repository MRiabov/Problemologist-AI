# Feature Specification: Agentic CAD Dashboard & 3D Debugger

**Feature**: 007-agentic-cad-dashboard
**Status**: Draft
**Mission**: software-dev

## 1. Overview

This feature provides a **Streamlit-based visual dashboard** ("Human-in-the-Loop" UI) for the Problemologist-AI environment. It serves as the primary window into the cognition and output of the two system agents:

1. **Engineer Agent**: Solving CAD benchmarks via an Architect-Engineer-Critic loop.
2. **Benchmark Generator Agent**: Creating puzzles via a Generator-Reviewer-Verify loop.

The dashboard supports three modes: **Real-Time Monitoring**, **Historical Review**, and **Benchmark Generator** (an interactive pipeline for co-creating physics puzzles).

### 4.4. Benchmark Generator Interface

The dashboard provides an interactive interface for the **Benchmark Generator Agent**:

* **Stage 1: Generation**: Prompt the **Generator** node to draft a scenario.
* **Stage 2: Review**: Display the **Internal Reviewer's** critique and allow manual plan/code edits.
* **Stage 3: Verification**: Trigger the **Verification Pipeline** (Geometry, MJCF, Sim checks) and display result.
* **Stage 4: Promotion**: Promote the verified benchmark to the production dataset.

### 4.2. 3D Visualization Capabilities

* **Format Support**: The system must support loading and rendering standard 3D mesh formats (e.g., STL) generated by the agent.
* **User Interaction**: The 3D viewport must support standard camera controls: Orbit (rotate), Zoom, and Pan.
* **Visual Fidelity**: The renderer must be capable of displaying the geometry clearly enough to inspect features like fillets and holes.

### 4.3. Data Integration

* **Data Source**: The dashboard must visualize data persisted in the system's primary storage (the "Thought-Process" database).
* **Real-Time Updates**: In "Live" mode, the dashboard must automatically refresh to show the latest agent actions without requiring manual page reloads.
* **Data Mapping**: The UI must correctly map and display all relevant step data: Input Prompt, **Reasoning/Thoughts**, Code, System Output, **Error Tracebacks**, and resulting Artifacts (Files/Images).
* **Visual Reconstruction Engine**: The dashboard MUST include a mechanism to re-run recorded CAD scripts with their original parameters to reconstruct visual previews at runtime if they are not stored as static artifacts.
* **Backup Management (Production)**: Provide a UI button or status indicator for the daily S3 backup process. The dashboard can trigger the backup endpoint if manual intervention is required.

## 5. Technical Design

### 5.1. Tech Stack

* **Framework**: `streamlit` (Python) for rapid UI development.
* **3D Rendering Library**: `stpyvista` (Streamlit PyVista wrapper) or `streamlit-components` with `three.js`. Backend processing via `trimesh`.
* **Database Connector**: `sqlalchemy` (read-only connection to `history.db`).
* **Syntax Highlighting**: Built-in `st.code` component.

### 5.2. Architecture

* **Entry Point**: `dashboard.py`.
* **Data Layer (`src/dashboard/data.py`)**: Responsible for querying `history.db`, polling for updates, and resolving relative file paths to absolute system paths.
* **Component Layer (`src/dashboard/components.py`)**: Reusable UI widgets for the Chat Log, Code Editor view, and 3D Viewport wrapper.
* **File Access**: The dashboard application requires read-access to the local `artifacts/` directory.

### 5.3. Implementation Details

* **Polling Strategy**: Use `st.empty()` container with a `time.sleep()` loop for the live monitoring view.
* **Schema Integration**: The dashboard will read from `Episodes`, `Steps`, and `Artifacts` tables defined in `src.persistence`.

## 6. Assumptions & Constraints

* **Local Execution**: The dashboard runs locally and accesses the filesystem directly (no remote S3 fetching).
* **Performance**: Large meshes (>10MB) might be slow to load in the browser; we assume MVP meshes are reasonably simple (<100k triangles).
* **Database Locking**: SQLite single-writer rule applies; the dashboard must use `read_only` connections to avoid blocking the running agent.
