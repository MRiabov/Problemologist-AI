# Prompt Discrepancies Analysis

Analysis of gaps between `config/prompts.yaml` and `kitty-specs/desired_architecture.md`.

---

## 1. In `prompts.yaml` but NOT in `desired_architecture.md`

<!-- commented out means we let it go intentionally and it should not return. -->
| **prompts.yaml Element** | **Issue** |
|---|---|
<!-- | **`cad_agent` hierarchy** (planner/actor/critic) | Architecture defines an **"Engineer"** with sub-agents: `planner`, `engineer`, `critic`. `prompts.yaml` uses `planner/actor/critic` – "actor" is never mentioned in the architecture. | -->
| **`preview_design` tool** | Not mentioned in the architecture. Arch specifies: `validate_and_price`, `simulate`, `submit_for_review`, `get_docs_for`. |
<!-- | **`analyze_design` tool** | Not in the architecture. Arch specifies `validate_and_price()` as the combined validation+pricing tool. | -->
<!-- | **`verify_solution` tool** | Not directly mentioned. Arch uses `submit_for_review(Compound)`. | -->

<!-- | **`write_script(content, path)` tool** | Arch says agents use `deepagents` filesystem: `write`, `edit`, `awrite`, `aedit`. `write_script` is a custom abstraction not in the arch. | -->
<!-- | **`search_docs` tool** | Arch specifies `get_docs_for(type)` which invokes a documentation **subagent** – different mechanism. | -->
<!-- | **`read_journal` tool** | Not in the arch. Journal is specified as a **file** (`journal.md`) the agent writes to, not a tool. | -->
<!-- yes, read journal -->
<!-- | **`linter_feedback` / `code_template`** | Prompt fragments not specified at this granularity in architecture. | -->
<!-- | **`benchmark_generator.critic` prompt** | Expects `{error}` and `{code}` template variables – this injection pattern isn't specified in the architecture. | -->
<!-- | **`force_submit` with budget override** | The cost guard and "HARD_LIMIT_REACHED" escalation flow has no counterpart in the architecture doc. | -->

<!-- notes: `verify_solution and `analyze_design` are superseded by `validate_and_price`.
`read_journal` is superseded by file reading.  -->
---

## 2. In `desired_architecture.md` but NOT in `prompts.yaml`

| **Architecture Requirement** | **Missing from prompts.yaml** |
|---|---|
| **Journal expectations** | No prompt instructs agents *how* to use the journal: Intent → Result → Reflection → Next step structure. |
| **TODO list handling** | Arch says planner creates a TODO list and engineer must implement it. Prompts don't mention TODO list workflow. |
| **Plan file auto-validation** | Arch says plan files are validated for structure – "refuses submission if doesn't match template". No mention in prompts. |
| **Refuse plan capability** | Engineer can refuse plans after proving they're impossible. Not in prompts. |
| **Reviews folder / YAML frontmatter** | Reviews go to `/reviews/review-round-[N]` with YAML frontmatter `decision: approved/rejected`. Not in prompts. |
| **`get_docs_for(type)` as subagent** | Clearly spec'd but prompts use `view_file` for docs instead. |
| **Benchmark → Engineer handover** | The YAML file with objectives, 24-view renders, exact positions, and **runtime randomization info**. The `actor` prompt mentions `objectives.yaml` but this isn't generated by bench generator prompts. |
| **Environment immutability verification** | Arch says validate that engineer didn't modify environment via hashing. Not in prompts. |
| **Skill reading from container path** | Arch says skills are in `skills/` folder in container. Prompts point to `docs/skills/...` – path mismatch. |
| **Critic reviewing simulation video** | Arch says reviewer focuses on video/image files. Prompts don't mention video review. |
| **Token compression** | Old memory should be summarized. No prompt handles this. |
| **Git commit on every `simulate()` call** | Arch says git commit happens at every successful simulate. Not in prompts. |
| **`simulate(Compound)` with perturbed positions** | Engineer's simulate runs multiple randomized tests. Not in prompts. |
| **Manufacturing method metadata** | Parts need `manufacturing_method` and `material-id` in metadata. Not instructed in prompts. |
| **COTS/off-the-shelf parts subagent** | A searching subagent for catalog DB. Not in prompts. |

---

## 3. Agent Interaction Gaps

The **inter-agent handover contracts** are under-specified:

| **Interaction Gap** | **Details** |
|---|---|
| **Planner → Coder contract** | What *exactly* does the planner output? Arch says it's a plan.md with specific sections. Prompts don't enforce this structure. |
| **Coder → Reviewer handover** | What does `submit_for_review(Compound)` pass? Arch says reviewer has read-only access to "all files" but this isn't operationalized. |
| **Reviewer → Coder feedback loop** | Reviews written to `/reviews/` folder, but prompts don't tell coder to *read* those files before continuing. |
| **Benchmark → Engineer handover** | Arch specifies: YAML with positions, 24 renders, moving parts info, runtime randomization. Neither doc specifies *who generates this YAML* or its schema. |
| **Token compression agent** | Who triggers this? When? Arch mentions it but no prompt or routing logic exists. |
| **Skill learner agent** | Arch extensively describes a "sidecar learner agent" that runs async. **Zero prompts for this agent.** |
| **Documentation subagent** | `get_docs_for(type)` should invoke a subagent. **No prompt exists.** |
| **COTS search subagent** | Catalog search subagent described in arch. **No prompt exists.** |
| **Critic escalation path** | What happens after "HARD_LIMIT_REACHED"? Goes to planner per prompts.yaml, but routing isn't in arch. |
| **Multi-agent concurrency** | Arch says 4 agents per machine, 1 simulation at a time. No prompt awareness of this constraint. |

---

## Summary of Critical Gaps

1. **Tool naming mismatch**: `prompts.yaml` uses `preview_design`, `analyze_design`, `verify_solution`, `write_script`. Architecture uses `validate_and_price`, `simulate`, `submit_for_review`, `write`/`edit` from deepagents.

2. **Missing agents entirely**: Skill learner, documentation subagent, COTS search subagent, token compression agent – all specified in architecture, zero prompts.

3. **Handover contracts undefined**: Inter-agent data flows (what artifacts are passed, what format, what validation) are vague in both documents.

4. **Journal/TODO structure**: Architecture is specific about these artifacts' formats. Prompts don't enforce or mention them.

5. **Path discrepancies**: `docs/skills/...` vs `skills/...` – needs alignment on container filesystem layout.

---

## Recommendations

1. **Reconcile tool names** – pick one naming convention and update both docs
2. **Define handover schemas** – create explicit Pydantic models or YAML schemas for inter-agent data
3. **Add missing prompts** – skill learner, doc subagent, COTS subagent, compression agent
4. **Add journal/TODO templates** – operationalize the episodic memory format in prompts
5. **Clarify filesystem paths** – align `docs/skills/` vs `skills/` across all docs
