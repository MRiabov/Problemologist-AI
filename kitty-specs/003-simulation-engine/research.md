# Research: MuJoCo Simulation Engine

## Core Simulation Strategy

The engine is responsible for verifying that the CAD models generated by agents actually function in a physical environment.

### 1. Engine Choice: MuJoCo

**Decision**: Use **MuJoCo** as the primary physics engine.
**Rationale**:

- **Speed**: Battle-tested, requires zero compile time, and supports high-speed batch simulations.
- **Stability**: Excellent handling of contact dynamics and constraints.
- **Limitations**: No FEA (deformation) or fluids in the MVP. Physically inadequate parts might "succeed" if they don't break under rigid-body assumptions.

### 2. Geometry Pipeline: CAD to MJCF

**Decision**: Automatic conversion via `build123d` -> STL -> MJCF.
**Rationale**:

- **Convex Decomposition**: MuJoCo physics prefers convex hulls. We use `trimesh` for hull generation and V-HACD for complex concave parts.
- **XML Verification**: MJCF is generated programmatically. Before full simulation, the XML is validated against the MuJoCo schema and a "warm-up" frame is run to detect intersections.

### 3. Simulation Objectives (AABB Zones)

**Decision**: Use Axis-Aligned Bounding Boxes (AABB) for environment sensors.
**Rationale**:

- **Build Zone**: Area where the agent is allowed to construct.
- **Goal Zone**: Target region for the moved object.
- **Forbid Zone**: Areas that trigger immediate failure if touched.
- **Out of Bounds**: Workspace limits that terminate simulation on escape.

### 4. Robustness & Randomization

**Decision**: Multi-run jittered simulation.
**Rationale**:

- Solutions must be robust. Each `simulate()` tool call runs multiple simulations with perturbed starting positions (jitter) to ensure the agent didn't just "get lucky".
- Success is only achieved if all jittered runs pass.

### 5. Video Rendering Pipeline

**Decision**: On-demand rendering.
**Rationale**:

- Rendering video is expensive. The engine only renders video if requested by the agent or if the simulation fails (for debugging).
- Videos and telemetry are uploaded to S3 (Railway Buckets) with short TTL (e.g., 24h) to save costs.
